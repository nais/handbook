
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://handbook.nais.io/technical/tenant-setup/addons/azure-ad/">
      
      
        <link rel="prev" href="../../">
      
      
        <link rel="next" href="../digdir/">
      
      
      <link rel="icon" href="../../../../assets/logo.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Azure AD - NAIS Handbook</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-ad" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="NAIS Handbook" class="md-header__button md-logo" aria-label="NAIS Handbook" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NAIS Handbook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure AD
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nais/handbook" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="NAIS Handbook" class="md-nav__button md-logo" aria-label="NAIS Handbook" data-md-component="logo">
      
  <img src="../../../../assets/logo.png" alt="logo">

    </a>
    NAIS Handbook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nais/handbook" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A handbook of sorts
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Administrative
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Administrative
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrative/fixtures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fixtures
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../administrative/slack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slack
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Social
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Social
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../social/the-great-outdoors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Great Outdoors
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Technical
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NAIS Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../production-ready/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What is production ready?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../publications-media/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Publications & Media
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../write-the-doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Write the doc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" checked>
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tenant setup
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Tenant setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up a tenant organization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_5_2" id="__nav_4_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Addons
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_5_2">
            <span class="md-nav__icon md-icon"></span>
            Addons
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Azure AD
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Azure AD
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-tenant" class="md-nav__link">
    <span class="md-ellipsis">
      For Tenant
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For Tenant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-service-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Google Service Accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-ad-application-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Azure AD Application Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microsoft-graph-object-id" class="md-nav__link">
    <span class="md-ellipsis">
      Microsoft Graph Object ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-access-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Application Access Groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-nais" class="md-nav__link">
    <span class="md-ellipsis">
      For NAIS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../digdir/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Digdirator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tokenx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TokenX
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Welcome
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../welcome/nais-manifest-eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NAIS is a AAAA rated platform service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../welcome/nais-sponsor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NAIS-Sponsor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../welcome/sponsor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Checklist for faddere
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#for-tenant" class="md-nav__link">
    <span class="md-ellipsis">
      For Tenant
    </span>
  </a>
  
    <nav class="md-nav" aria-label="For Tenant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#google-service-accounts" class="md-nav__link">
    <span class="md-ellipsis">
      Google Service Accounts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-ad-application-registration" class="md-nav__link">
    <span class="md-ellipsis">
      Azure AD Application Registration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microsoft-graph-object-id" class="md-nav__link">
    <span class="md-ellipsis">
      Microsoft Graph Object ID
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-access-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Application Access Groups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-nais" class="md-nav__link">
    <span class="md-ellipsis">
      For NAIS
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="azure-ad">Azure AD<a class="headerlink" href="#azure-ad" title="Permanent link">&para;</a></h1>
<p><a href="https://github.com/nais/azurerator">:fontawesome-brands-github: nais/azurerator</a> creates and manages Azure AD applications via Kubernetes Custom Resources for <a href="https://doc.nais.io/security/auth/azure-ad/">use in various authentication scenarios</a>.</p>
<p>This is an optional addon in NaaS. It is not enabled by default.</p>
<h2 id="for-tenant">For Tenant<a class="headerlink" href="#for-tenant" title="Permanent link">&para;</a></h2>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<p>To be able to use this addon, you will need to bring your own <a href="https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis">Azure AD tenant</a>.</p>
<p>Unfortunately, we do not offer provisioning nor management of Azure AD itself as a service.
The Azure AD tenant must be wholly owned and operated by your organization.</p>
<p>You will also need to set up a couple of things within said tenant. We'll guide you through the steps.</p>
<h3 id="google-service-accounts">Google Service Accounts<a class="headerlink" href="#google-service-accounts" title="Permanent link">&para;</a></h3>
<p>Azurerator uses <a href="https://learn.microsoft.com/en-us/graph/api/resources/federatedidentitycredentials-overview?view=graph-rest-1.0">federated credentials</a>
in order to authenticate itself to your Azure AD tenant, by using tokens issued by Google. 
This removes the need to share client secrets between our organizations.
The tokens are in turn only issued to Google Service Accounts that exist within the NAIS projects that we've created for your Google organization.</p>
<p>To set this up, you will need to find some identifiers from within your Google organization:</p>
<ol>
<li>Find the NAIS Google Project IDs:<ol>
<li>Use the <code>gcloud</code> CLI: <code>gcloud projects list --filter="nais-"</code></li>
<li>There should be one project ID for each environment; <code>nais-dev-xxxx</code> and <code>nais-prod-xxxx</code>. Note these down.</li>
</ol>
</li>
<li>For each project ID, find the unique Service Account ID for Azurerator:<ol>
<li><code>gcloud iam service-accounts describe azurerator@&lt;PROJECT_ID&gt;.iam.gserviceaccount.com</code>, where <code>PROJECT_ID</code> is the ID found in the previous step.</li>
<li>Note down the <code>uniqueId</code> for the service account. This ID uniquely identifies the Google Service Account that Azurerator uses in each environment.</li>
</ol>
</li>
</ol>
<h3 id="azure-ad-application-registration">Azure AD Application Registration<a class="headerlink" href="#azure-ad-application-registration" title="Permanent link">&para;</a></h3>
<p>An <a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/app-objects-and-service-principals">Azure AD application registration</a>
within the tenant mentioned above is needed for Azurerator to create and manage application registrations within Azure AD.</p>
<ol>
<li>Sign in to your Azure Account through the <a href="https://portal.azure.com/">Azure portal</a>.</li>
<li>Select <strong>Azure Active Directory</strong>.</li>
<li>Select <strong>App registrations</strong>.</li>
<li>Select <strong>New registration</strong>.<ol>
<li>Name the application, for example "azurerator".</li>
<li>Supported account type doesn't matter, single tenant is fine. </li>
<li>Leave <strong>Redirect URI</strong> empty.</li>
</ol>
</li>
<li>Under <strong>Overview</strong>, note down the values for the following fields:<ol>
<li><strong>Application (client) ID</strong>.</li>
<li><strong>Directory (tenant) ID</strong></li>
</ol>
</li>
<li>Navigate to <strong>Certificates and secrets</strong>.<ol>
<li>Select <strong>Federated credentials</strong>.</li>
<li>Select <strong>Add credentials</strong>.</li>
<li>Under <strong>Federated credential scenario</strong>, select <strong>Other issuer</strong>.</li>
<li>Under <strong>Issuer</strong>, enter the value <code>https://accounts.google.com</code></li>
<li>Under <strong>Subject</strong>, enter the value for <code>uniqueId</code> that you noted down from the <a href="#google-service-accounts">previous section on Google Service Accounts</a>.</li>
<li>Under <strong>Name</strong>, enter the value <code>nais-&lt;environment&gt;</code>, for example <code>nais-dev</code> or <code>nais-prod</code></li>
<li>Leave the <strong>Audience</strong> at the default value, i.e. <code>api://AzureADTokenExchange</code></li>
<li>Repeat the steps starting from step <strong>6</strong> with the second <code>uniqueId</code> from the <a href="#google-service-accounts">previous section on Google Service Accounts</a>.</li>
</ol>
</li>
<li>
<p>Navigate to <strong>API permissions</strong>.</p>
<ol>
<li>Select <strong>Add a permission</strong>.</li>
<li>Select <strong>Microsoft Graph</strong>.</li>
<li>Select <strong>Application permissions</strong>.</li>
<li>The application needs the following permissions:<ul>
<li><code>Application.ReadWrite.All</code></li>
<li><code>DelegatedPermissionGrant.ReadWrite.All</code></li>
<li><code>GroupMember.Read.All</code></li>
</ul>
</li>
<li>Add the permissions.</li>
<li>Select <strong>Grant admin consent for &lt;tenant name&gt;</strong>.</li>
<li>Confirm to grant the application access to the configured permissions.</li>
</ol>
<p>If done correctly, the list of permissions should look like this:</p>
<p><img alt="The list of configured permissions for the Application registration in Azure AD. The permissions Application.ReadWrite.All, DelegatedPermissionGrant.ReadWrite.All and Group.Read.All for the Microsoft Graph API are all added as Application permissions. Admin consent has been granted to all of the permissions." src="../../../../assets/azure-ad-permissions-setup.png" /></p>
</li>
</ol>
<h3 id="microsoft-graph-object-id">Microsoft Graph Object ID<a class="headerlink" href="#microsoft-graph-object-id" title="Permanent link">&para;</a></h3>
<p>In order for Azurerator to pre-approve delegated API permissions for the managed applications,
you will need to find the <strong>Object ID</strong> for the Microsoft Graph Enterprise Application that is unique to each Azure AD tenant.</p>
<ol>
<li>Sign in to your Azure Account through the <a href="https://portal.azure.com/">Azure portal</a>.</li>
<li>Select <strong>Azure Active Directory</strong>.</li>
<li>Select <strong>Enterprise applications</strong>.</li>
<li>Filter the list of applications:<ol>
<li><strong>Applicaton ID starts with</strong> == "00000003-0000-0000-c000-000000000000"</li>
<li><strong>Application type</strong> == "Microsoft Applications"</li>
</ol>
</li>
<li>You should see an application named <code>GraphAggregatorService</code> or <code>Microsoft Graph</code>.</li>
<li>Note down the <strong>Object ID</strong> for this application.</li>
</ol>
<h3 id="application-access-groups">Application Access Groups<a class="headerlink" href="#application-access-groups" title="Permanent link">&para;</a></h3>
<p>Azurerator creates Azure AD application registrations that are restricted by default:</p>
<ul>
<li>Users are not allowed access to the application unless they are explicitly given access.</li>
<li>Access is granted by group membership; groups are assigned directly to applications.</li>
<li>Users must be direct members of the groups, i.e. nested groups will not work.</li>
</ul>
<p>You will need to define a group that contains all users in your tenant. 
The definition of "all users" is left for you to decide. This can for example be:</p>
<ul>
<li>all users, including guest accounts and machine users</li>
<li>all users that are not guests in your tenant</li>
<li>all users that have a valid license</li>
<li>all users within a certain department, and so on</li>
</ul>
<p>Refer to the following guides at Microsoft for details on groups:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-gb/azure/active-directory/fundamentals/how-to-manage-groups">creating and managing groups</a> </li>
<li><a href="https://learn.microsoft.com/en-gb/azure/active-directory/enterprise-users/groups-dynamic-membership">dynamic group memberships</a></li>
</ul>
<p>The all users group will be assigned to any application that has enabled the <code>allowAllUsers</code> directive. 
Note down the <strong>object ID</strong> for this group.</p>
<hr />
<p>Once you've got through all of the above, provide the NAIS team with the following information:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Property</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Tenant ID</td>
<td style="text-align: left;">See <a href="#azure-ad-application-registration">Azure AD Application Registration</a></td>
</tr>
<tr>
<td style="text-align: left;">Client ID</td>
<td style="text-align: left;">See <a href="#azure-ad-application-registration">Azure AD Application Registration</a></td>
</tr>
<tr>
<td style="text-align: left;">Microsoft Graph Object ID</td>
<td style="text-align: left;">See <a href="#microsoft-graph-object-id">Microsoft Graph Object ID</a></td>
</tr>
<tr>
<td style="text-align: left;">Default All-Users Group Object ID</td>
<td style="text-align: left;">See <a href="#application-access-groups">Application Access Groups</a></td>
</tr>
</tbody>
</table>
<h2 id="for-nais">For NAIS<a class="headerlink" href="#for-nais" title="Permanent link">&para;</a></h2>
<ol>
<li>Enter the required configuration for <code>azurerator</code> in Fasit, using the information given by the tenant</li>
<li>Enable the <code>azurerator</code> feature in Fasit</li>
<li>Enable the <code>azurerator</code> feature within <code>naiserator</code> in Fasit</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.annotate", "navigation.instant"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
        <script src="../../../../amplitude_javascript/events.js"></script>
      
    
  </body>
</html>